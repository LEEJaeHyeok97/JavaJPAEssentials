# 단방향 연관관계

- 참조 대신에 외래키를 그대로 사용하면 안된다
- em.persist()로 영속화 하면 pk 값이 생성되고 영속된다.

## 객체를 테이블에 맞추어 데이터 중심으로 모델링하면, 협력 관계를 만들 수 없다.

- 테이블은 외래 키로 조인을 사용해서 연관된 테이블을 찾는다.
- 객체는 참조를 사용해서 연관된 객체를 찾는다.
- 테이블과 객체 사이에는 이런 큰 간격이 있다.

## 객체 지향 모델링(객체 연관관계 사용)

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/d585b519-8573-4b79-a92a-7a04a0718b84/22fc937a-3976-463b-8f28-a2745b2d41ee/Untitled.png)

- 데이터를 저장할 때

```java
// 저장
Team team = new Team();
team.setName("TeamA");
em.persist(team);

Member member = new Member();
member.setUsername("member1");
member.setTeam(team); // JPA 가 알아서 PK를 꺼내서 INSERT 시 FK로 사용한다.

Team findTeam = findMember.getTeam(); // 참조된 테이블에서 팀을 찾는다.
```

# 양방향 연관관계와 연관관계의 주인 1 - 기본

## 누구를 주인으로?

- 외래 키가 있는 곳을 주인으로 정해라
- 이 기준으로 간단하게 JPA 사용가능

# 양방향 연관관계와 연관관계의 주인 2- 주의점, 정리

- Setter는 쓰지 않고 ChangeMethod를 따로 만들어서 사용한다.
    - 중요한 변경이라는 인식을 줄 수 있다.

## 양방향 연관관계 주의 - 실습

- 순수 객체 상태를 고려해서 항상 양쪽에 값을 설정하자
- 연관관계 편의 메소드를 생성하자
- 양방향 매핑시에 무한 루프를 조심하자
    - 예: toString(), lombok, JSON 생성 라이브러리

실무에서 컨트롤러에서 엔티티를 반환하면 안된다.

→ 이것만 해도 많은 문제가 해결된다.

## 양방향 매핑 정리

- 단방향 매핑만으로도 이미 연관관계 매핑은 완료
- 양방향 매핑은 반대 방향으로 조회 기능이 추가된 것 뿐
- JPQL에서 역방향으로 탐색할 일이 많음
- 단방향 매핑을 잘 하고 양방향은 필요할 때 추가해도 됨(테이블에 영향을 주지 않음)
- 설계 입장에서 양방향은 좋을게 없다.
    - 고려할게 복잡해지고 많아진다.
    - 이득이 객체 입장에서 거의 없다.

<aside>
💡 단방향 매핑을 잘 하고 양방향은 필요할 때 추가해도 됨(테이블에 영향을 주지 않음)

</aside>

**연관관계의 주인은 외래키 위치를 기준으로 정해야함**

가능하면 단방향으로 해라.

비즈니스 상 설계를 잘 고려해야한다.